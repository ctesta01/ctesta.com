<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Testa">
<meta name="dcterms.date" content="2024-05-12">

<title>Christian Testa - Bhramar Mukherjee’s Marvin Zelen Award Talk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Christian Testa</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bhramar Mukherjee’s Marvin Zelen Award Talk</h1>
  <div class="quarto-categories">
    <div class="quarto-category">talks</div>
    <div class="quarto-category">statistics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Testa </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This last Thursday (May 9th, 2024), Bhramar Mukherjee received the annual Marvin Zelen Award from the Harvard Biostatistics Department.</p>
<p>Sometimes a talk leaves you with enough food for thought that you simply have to write down the highlights somewhere you know you can come back to them, and Dr.&nbsp; Mukherjee’s certainly fits the bill.</p>
<p>Her talk was on <em>Data Equity in Health Research</em>.</p>
<hr>
<p>On the nascency of the field:</p>
<p>She asks the question: when was the first textbook in statistics written, soliciting guesses from the audience. The answer is in Agresti, A. (2023). A historical overview of textbook presentations of statistical science. Scand J Statist, 50(4), 1641–1666. https://doi.org/10.1111/sjos.12641.</p>
<p>She also highlighted <a href="https://magazine.amstat.org/blog/2016/12/08/sih-norwood/">Janet Norwood</a> several times throughout her talk, emphasizing the quote, “Women have to take advantage of the opportunities presented to them; it often isn’t quite as straight a career path as it is for men.”</p>
<p>The point, from how I understood it, is that our field of (bio-)statistics is still finding its way — and we all in it have an active role in shaping what that will be.</p>
<hr>
<p>On Marvin Zelen and his legacy:</p>
<p>“What remains after papers and awards fade away are people and culture.”</p>
<p>She argues that though critical work was done by Marvin Zelen, the truly impactful legacy in is effect on the department —&nbsp;making it a welcoming place, intellectually curious, and emphasizing “statistical science” — that the field cannot be just methods, but must be grounded in science too.</p>
<hr>
<p>On the racial/ethnic makeup of biobank/genetics study participants:</p>
<p>She showed this figure from Fatumo, S., Chikowore, T., Choudhury, A. et al.&nbsp;A roadmap to increase diversity in genomic studies. Nat Med 28, 243–250 (2022). https://doi.org/10.1038/s41591-021-01672-4</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/biobank_racial_ethnic_makeup.png" class="img-fluid figure-img"></p>
<figcaption>A graph showing side-by-side the proportion of genetic database participants by racial/ethnic group with the world composition; white/european populations are overrepresented, while Southeast Asian are barely visible in genetic database cohorts.</figcaption>
</figure>
</div>
<p>Driving home the point, she pointed out to us that her parents are Indian and hence in the barely represented South Asian portion of the above graph, and asked “When will my parents have access to precision medicine?”</p>
<hr>
<p>On data inequities:</p>
<p>Citing LaVeist (2023), she points out the economic loss due to racial/ethnic disparities. Even if one sets aside the (paramount, crucial, necessary) moral arguments about health justice, there is an undeniable economic toll attributable due to preventable disparities in marginalized vs.&nbsp;privileged groups.</p>
<p>LaVeist TA, Pérez-Stable EJ, Richard P, et al.&nbsp;The Economic Burden of Racial, Ethnic, and Educational Health Inequities in the US. JAMA. 2023;329(19):1682–1692. doi:10.1001/jama.2023.5965</p>
<p>Chunara, R., Gjonaj, J., Immaculate, E., Wanga, I., Alaro, J., Scott-Sheldon, L. A. J., et al.&nbsp;(2024). Social determinants of health: The need for data science methods and capacity. Volume 6, Issue 4, e235-e237. https://doi.org/10.1016/S2589-7500(24)00022-0</p>
<p>This motivates her work in thinking about how to fully capture the myriad causes that actually drive health in her research.</p>
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/chunara_et_al.jpg" class="img-fluid"></p>
<p>She described the ‘vicious cycle’ that health-affecting algorithms can enter, where existing disparities and systemic discrimination bias training datasets, biasing algorithms, affecting real-life access to resources, intervention, and disadvantaging already disadvantaged communities, leading to a perpetuation of the cycle.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/chin_et_al.png" class="img-fluid figure-img"></p>
<figcaption>Conceptual Framework for Applying Guiding Principles to Mitigate and Prevent Bias Across an Algorithm’s Life Cycle. This conceptual framework builds on a National Academy of Medicine algorithm life cycle framework adapted by Roski et al.</figcaption>
</figure>
</div>
<p>Marshall H. Chin, et al.&nbsp;Guiding Principles to Address the Impact of Algorithm Bias on Racial and Ethnic Disparities in Health and Health Care. JAMA Network Open. 2023;6(12):e2345050. doi:10.1001/jamanetworkopen.2023.45050</p>
<p>These <em>data inequities</em>, distinct from and also deeply intrinsically tied to <em>health inequities</em>, are part of what Dr.&nbsp;Mukherjee calls “The Data Struggle of the Unseen” [<a href="https://www.vassar.edu/news/events/2024/data-struggle-unseen">1</a>, <a href="https://www.youtube.com/watch?v=zH4GFIcbSgc">2</a>]</p>
<p>To the end of upending these vicious cycles, she cites the work on guidelines for mitigating risk in health-system algorithms: Collins, G. S., Dhiman, P., Andaur Navarro, C. L., Ma, J., Hooft, L., Reitsma, J. B., Logullo, P., Beam, A. L., Peng, L., Van Calster, B., van Smeden, M., Riley, R. D., &amp; Moons, K. G. (2021). Protocol for development of a reporting guideline (TRIPOD-AI) and risk of bias tool (PROBAST-AI) for diagnostic and prognostic prediction model studies based on artificial intelligence. BMJ open, 11(7), e048008. <a href="https://doi.org/10.1136/bmjopen-2020-048008" class="uri">https://doi.org/10.1136/bmjopen-2020-048008</a></p>
<hr>
<p>On the work of Marvin Zelen and Stephen Lagakos, and their legacy in community-engaged work:</p>
<p>In the late 70s and 80s, Marvin Zelen, Stephen Lagakos and others led a series of analyses on the effects of contaminated well-water in Woburn, MA.</p>
<blockquote class="blockquote">
<p>Known as the Harvard Health Study, the investigation showed, for the first time, a connection between Woburn’s contaminated water and a variety of adverse health effects, including leukemia. The matter made headlines, wound up in court, and was chronicled in the book A Civil Action, which was later made into a movie. As the book notes, when Prof.&nbsp;Zelen announced the study’s results in the basement of a Woburn church in February 1984, someone in the audience called out, “Thank God for Marvin Zelen,” and the crowd burst into applause.</p>
</blockquote>
<p>From <a href="https://www.hsph.harvard.edu/news/features/in-memoriam-prof-marvin-zelen-a-tremendous-force-in-biostatistics/" class="uri">https://www.hsph.harvard.edu/news/features/in-memoriam-prof-marvin-zelen-a-tremendous-force-in-biostatistics/</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/zelen_lagakos.png" class="img-fluid figure-img"></p>
<figcaption>Figure from 1986, JASA, Shaded map of Woburn showing levels of exposure to contaminated wells</figcaption>
</figure>
</div>
<p>See <a href="https://sphweb.bumc.bu.edu/otlt/mph-modules/woburnleukemia/Lagakos_et_al_Woburn.pdf" class="uri">https://sphweb.bumc.bu.edu/otlt/mph-modules/woburnleukemia/Lagakos_et_al_Woburn.pdf</a> for a copy of one of the original papers.</p>
<p>Coincidentally, in 2023 <a href="https://www.epa.gov/newsreleases/biden-harris-administration-proposes-ban-trichloroethylene-protect-public-toxic">the EPA just proposed a ban on one of the chemicals identified in the Lagakos et al study</a></p>
<p>Mukherjee relates Zelen and Lagakos’ community-engaged work to her own fieldwork-focused projects in India related to maternal-health. When confronted by her academic advisor who said something along the lines that “this isn’t biostatistics!” She says she said back, “Well, sorry, but you have tenured me.”</p>
<p>She seemed to admonish some tenured faculty, saying “why do you play it so safe?” Why don’t you take a risk?</p>
<p>Later during the talk, she said that there is a common refrain “Statistician’s play in everyone’s backyard, but I am not happy with just a backyard. I want a front-yard, a garden, a forest.” Meaning, it’s easy for statisticians to lament the quality of the data they’re given, but she sees this as an impetus to get involved and improve study-design and data-collection from its conception.</p>
<hr>
<p>On the effects of doing data-equity focused work on her career:</p>
<p>Driven by a lack of quality reporting on COVID-19 in India, Mukherjee and colleagues did quite a lot of early and sustained writing about the pandemic.</p>
<p>She recalled a story of meeting a couple in an airport in India who recognized her and said that they based their decision on when to move their parents from one city to another based on her work. This, for her, was a clear and powerful example of how she was making a real difference in peoples’ lives.</p>
<p>However, she also received death-threats due to her work. When talking with her father about it, he said to her “You received a death threat, but you seem happy about it (?)” To that, she said she was because “I at least have done something as a statistician to be kill-worthy.”</p>
<hr>
<p>On getting involved with study-design and rollout as a statistician:</p>
<p>Mukherjee argues it’s simply not enough for (bio-)statisticians to wish that the data quality were better, more representative, that it captured marginalized groups with higher coverage, but necessary that (bio-)staticicians get involved and <em>design their own studies</em> in collaboration with epidemiologists and other subject matter experts.</p>
<p>To that end, Mukherjee describes her involvement with <a href="https://mydatahelps.org">MyDataHelps</a>, an online mobile-phone centric platform that makes it possible so that participants can contribute their data without having to do long surveys all at once. She emphasized that they can just push one or two questions at a time. On traditional biostatistics, she said that this is why the foundations of our field in sampling design are so crucial: because now, as we adapt what it means to collect data in the 21st century, we have to update our notions of how survey data should be collected and analyzed.</p>
<div class="grid">
<div class="g-col-6">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/mi_cares_logo.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption>Logo for MI-CARES, Understanding the Impact of Our Environment</figcaption>
</figure>
</div>
</div>
<div class="g-col-6">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/mi_cares_map.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption>Environmental (in-)justice map</figcaption>
</figure>
</div>
</div>
</div>
<p>She also described her involvement in <a href="https://ceecr.org/cohorts/mi-cares/">MI-CARES</a>, a huge grant focused on over-sampling racial/ethnic minority populations in Michigan, and to be ‘the one study that does it all’ in terms of capturing cardio-metabolomics, epigenomics, environmental justice, residential measures, discrimination, etc., etc., etc., so that we can truly have one dataset where all of the complexities of health are measured longitudinally (over-time) for a cohort of people who are not traditionally well-represented in science, public health, and medicine.</p>
<p>She said of her engagement with fieldwork based science: “That year, if I publish less papers, I don’t care, because I am going to go for glorious failure.” As in, she would rather go for glorious failure attempting to do community-engaged work than traditional success in biostatistics publishing yet another methods paper that only gets cited by subsequent methods papers.</p>
<hr>
<p>On Imperfect Data:</p>
<p>She referenced Xiaoli Meng’s <a href="https://statistics.fas.harvard.edu/files/statistics-2/files/statistical_paradises_and_paradoxes.pdf">2018 article <em>Statistical Paradises and Paradoxes in Big Data: Law of Large Populations, Big Data Paradox, and the 2016 US Presidential Election</em></a>, which highlighted the “Curse of Large N.”</p>
<p>She points out that it doesn’t do much good to shrink the variance of an estimator as <span class="math inline">\(N \to \infty\)</span> if the fundamental estimate is biased, because now we are simply becoming “precisely wrong.”</p>
<p>Mukherjee argues that (bio-)statisticians are <em>uniquely</em> poised among the data-analytic disciplines (computer science, mathematics, bioinformatics, data science, machine learning) to address issues like selection bias, aggregation bias, measurement error, survivorship bias, etc., because we are intimately connected with epidemiology and concerned with the data-generating mechanisms that lead to missingness, drop-out, self-selection, loss-to-follow-up, etc., whereas many other disciplines take the data “as given.”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/img/2024-05-12-Bhramar-Mukherjee/Types-of-survey-errors.png" class="img-fluid figure-img"></p>
<figcaption>An example of the hierarchy of survey-errors, from <em>Response Order Effects in Online Surveys: An Empirical Investigation</em> by Sanjeev M, Int J of Online Marketing</figcaption>
</figure>
</div>
<hr>
<p>My Synthesis:</p>
<p>In my opinion, few words can do justice to how inspiring it was to hear from a leader in the field who so unequivocably advocates for the field’s focus on community-engaged work, a social determinants of health -centric vision of health systems, a mission to reverse the vicious cycles of algorithmic bias and discrimination, and who speaks truth to power, asking why tenured faculty are so reluctant to try something new in deviating away from their methodological work to focus on projects with more concrete real-world impact.</p>
<p>Mukherjee was clear: the methodological work has its place, and largely seemed to emphasize that without an early career in methods-focused projects (bringing with them motivation to develop theory underlying the methods), her recent work that is in relation to communities would not have been the same — it would not have been informed by the same methodological considerations, or by her accumulated wealth of knowledge about, say, survey design and methods to account for complex missingness patterns and/or bias-introducing-mechanisms.</p>
<p>At once highlighting the merits and shortcomings of the field, Mukherjee leaves us with significant food for thought: it is simply not enough for biostatisticians who aspire to be ‘data dreamsers’ to live in an ivory tower focused solely on theoretical considerations when there is so much to contribute to work on-the-ground that reshapes people’s lives for the better. As she reminded me at the event’s reception, for Zelen and Lagakos to present their findings in a church’s basement in Woburn was to truly engage with the public, and to hear someone cry out “Thank God for Marvin Zelen” speaks volumes to the impact our field can have if we center the lived experiences of the communities we want to uplift.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>